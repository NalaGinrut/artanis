image: debian:sid-slim

before_script:
  - apt-get -qq update
  - apt-get -qq -y install guile-3.0 build-essential automake git autoconf libtool libmariadbclient-dev libmariadbd-dev libnss3 libnss3-dev
  - git clone --depth 1 git://github.com/opencog/guile-dbi.git 
  - cd guile-dbi/guile-dbi
  - ./autogen.sh 
  - ./configure --prefix=/usr && make
  - make install 
  - ldconfig 
  - cd .. 
  - cd guile-dbd-mysql 
  - ./autogen.sh 
  - ./configure --prefix=/usr && make 
  - make install && ldconfig && cd ..
test:
  stage: test
  script:
   - ./autogen.sh
   - mkdir -p build && cd build && ../configure
   - make V=
   - make install
   - make test && guile -c '(display (@ (artanis artanis) artanis-version))'
  only:
    - master
stages:
  - test
